<template>
  <lightning-card>
    <template if:true={duplicateRecFound}>
      <p>
        We found {duplicateRecPair} duplicate group(s) for this matching rule.
      </p>
      <template for:each={preparedRecordDetails} for:item="group" for:index="index">
        <div key={index.Id}>
          <!-- Master record row -->
          <lightning-datatable key-field="Id" data={group.master} columns={masterColumns} hide-checkbox-column
            onrowaction={handleRowAction} data-index={index}>
          </lightning-datatable>

          <!-- Child records table -->
          <div class="child-records" data-index={index} style="display: none;">
            <lightning-datatable hide-table-header="true" key-field="Id" data={group.children} columns={columns}
              hide-checkbox-column onrowaction={handleRowAction}>
            </lightning-datatable>
          </div>
        </div>
      </template>

      <!-- Modal/PopUp for Merge Preview -->
      <template if:true={isShowModal}>
        <section class="slds-modal slds-fade-in-open slds-modal_large" role="dialog" aria-labelledby="modal-heading"
          aria-modal="true">

          <!-- Header of the Modal -->
          <div class="slds-modal__container">
            <header class="slds-modal__header">
              <h2 id="modal-heading" class="slds-text-heading_medium">Merge</h2>
            </header>

            <!-- Body of the Modal -->
            <div
              class="slds-modal__content slds-p-around_medium slds-scrollable_y slds-scrollable_x scrollable-content">
              <table>
                <thead>
                  <tr>
                    <th class="header-custom-box slds-p-around_x-small">Preview Master</th>
                    <template for:each={headerList.value} for:item="item" for:index="headerIndex">
                      <th key={item} class="header-custom-box slds-p-around_x-small">
                        <lightning-input type="radio" label={headerLabel} name="headerRadioButton"
                          onchange={handleRadioButtonOnHeader} data-index="header" data-id={headerIndex}>
                        </lightning-input>
                      </th>
                    </template>
                  </tr>
                </thead>
                <tbody>
                  <template for:each={fieldValuesWithLabelAndValues} for:item="fieldVal" for:index="rowIndex">
                    <tr key={fieldVal} data-index={rowIndex}>
                      <td class="custom-box slds-p-around_x-small">
                        <lightning-input type="text" label={fieldVal.label} name={fieldVal.Label}
                          data-index={rowIndex}></lightning-input>
                      </td>
                      <template for:each={fieldVal.value} for:item="value" for:index="columnIndex">
                        <td key={value} class="custom-box slds-p-around_x-small" data-id={columnIndex}>

                          <!-- Internal table for Radio Button and Column Value -->
                          <table class="inner-table slds-p-around_x-small">
                            <tbody>
                              <tr>
                                <td style="text-align:center;">
                                  <lightning-input type="radio" label={fieldVal.label} value={value} name={rowIndex}
                                    data-id={columnIndex} onchange={handleRadioButtonOnField} data-index={rowIndex}>
                                  </lightning-input>
                                </td>
                              </tr>
                              <tr data-id="valueRow">
                                <td class="value-font" data-id={columnIndex}>{value}</td>
                              </tr>
                            </tbody>
                          </table>

                        </td>
                      </template>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

            <!-- Footer of the Modal -->
            <footer class="slds-modal__footer">
              <lightning-button label="Close" onclick={handleCloseButton}></lightning-button>
              <lightning-button variant="brand" label="Merge" onclick={handleMergeButton}
                class="slds-m-left_x-small"></lightning-button>

            </footer>
          </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
      </template>
    </template>
    <template if:false={duplicateRecFound}>
      <p>No data available.</p>
    </template>
  </lightning-card>
</template>